<!DOCTYPE html>
<html lang="en">
<head>
  	<meta charset="utf-8" />
	<title>A crash course in python packaging</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" property="og:description" content="This guide isn't for the newbie who is just learning python programming (they are better off doing a "proper" reading of the official docs instead). This is for the seasoned coder who dabbles in multiple technologies and needs a quick refresher on how to go about building a neat zip …">
	<link rel="canonical" content="https://prahladyeri.github.io/blog/2020/07/a-crash-course-in-python-packaging.html" />
	<meta name="author" content="Prahlad Yeri">
	<link rel="stylesheet" href="/theme/css/app.css?v=1.4">
	<link rel="stylesheet" href="/theme/css/pygment.css">		
	<link rel="shortcut icon" type="image/x-icon" href="/uploads/py.png" />
	<link href="https://prahladyeri.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Full Atom Feed" />
	<link href="https://prahladyeri.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Prahlad Yeri's Blog Full RSS Feed" />
	<link href="https://prahladyeri.github.io/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Categories Atom Feed" />




    <meta name="tags" content="Python" />
    <meta name="tags" content="Setup" />
    <meta name="tags" content="PyPi" />
    <meta name="tags" content="Crash Course" />

	
	<!-- fosstodon verify -->
	<a style='display:none'  rel="me" href="https://fosstodon.org/@prahladyeri">Fosstodon</a>
	<!-- mastodon verify -->
	<a style='display:none' rel="me" href="https://mastodon.social/@prahladyeri">Mastodon</a>
	
	<!-- pinterest verify -->
	<meta name="p:domain_verify" content="a57360faef2ee56807b63d62092a849a"/>
	
	<!-- twitter card meta data -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@prahladyeri" />
	<meta name="twitter:creator" content="@prahladyeri" />
		<meta name="twitter:url" content="https://prahladyeri.github.io/blog/2020/07/a-crash-course-in-python-packaging.html" />
		<meta name="twitter:title" content="A crash course in python packaging" />
		<meta name="twitter:description" content="This guide isn't for the newbie who is just learning python programming (they are better off doing a "proper" reading of the official docs instead). This is for the seasoned coder who dabbles in multiple technologies and needs a quick refresher on how to go about building a neat zip …" />
			<meta name="twitter:image" content="https://prahladyeri.github.io/uploads/toolbox.jpg" />
			<meta name="image" property="og:image" content="https://prahladyeri.github.io/uploads/toolbox.jpg">

	
	
</head>

<body>
<div id='header'>
<div class='text-center' >
	<h1 class='blog-title'>Prahlad Yeri</h1>
	<h4  class='blog-tagline'>Freelance Programmer and Writer</h4>
</div>

<div id='navBlock' class='text-center' >
	<a class="nav-link" href="/">Home</a> | 
	<a class="nav-link" href="/blog">Blog</a> | 
	<a class="nav-link" href="/portfolio">Portfolio</a> | 
	<a class="nav-link" href="https://github.com/prahladyeri/resume">Resume</a> | 
	<a class="nav-link" href="/hire-me">Hire Me</a>
	<br>
	Social:
	<a class="nav-link" href="https://twitter.com/prahladyeri">Twitter</a> | 
	<a class="nav-link" href="https://github.com/prahladyeri">Github</a> | 
	<a class="nav-link" href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a> | 
	<a class="nav-link" href="https://prahladyeri.medium.com/">Medium</a> | 
	<a class="nav-link" href="https://www.quora.com/profile/Prahlad-Yeri">Quora</a>
	<br>
	Email: prahladyeri at yahoo dot com | 
	Feeds:
	<a class="nav-link" href="/feeds/all.rss.xml">RSS</a> | 
	<a class="nav-link" href="/feeds/all.atom.xml">ATOM</a>
</div>
</div>
<div id="main" class='row content '>
<div class='col w50 m-auto'>
<section id="content" class="body">
  <header>
	<h1 style='color: darkolivegreen;' class='mt-4 mb-4'>A crash course in python packaging</h1>
 
  </header>
  <footer class="post-info clearfix">
	<span class='float-left'>
    <time class="text-muted published" datetime="2020-07-02T20:25:00+05:30">Thu 02 July 2020</time>
    <div class="text-muted vcard author">
      By           <a class="url fn" href="https://prahladyeri.github.io/">Prahlad Yeri</a>
    </div>
	</span>
	<div class='float-right'>
    <div class="text-muted category text-right">
        Filed under <a href="https://prahladyeri.github.io/blog/category/python">Python</a>
    </div>
    <div class="text-muted tags">
		Tags
            <a href="https://prahladyeri.github.io/blog/tag/python">Python</a>
            <a href="https://prahladyeri.github.io/blog/tag/setup">Setup</a>
            <a href="https://prahladyeri.github.io/blog/tag/pypi">PyPi</a>
            <a href="https://prahladyeri.github.io/blog/tag/crash-course">Crash Course</a>
    </div>
	</div>
  </footer><!-- /.post-info -->
  
  <div class="entry-content">
    <p>This guide isn't for the newbie who is just learning python programming (they are better off doing a "proper" reading of the <a href="https://packaging.python.org/">official docs</a> instead). This is for the seasoned coder who dabbles in multiple technologies and needs a quick refresher on how to go about building a neat zip or tar.gz package from their existing python code, and optionally upload it to python package index (pypi).</p>
<p><img alt="toolbox" src="/uploads/toolbox.jpg"></p>
<p>First of all, its necessary to encapsulate your individual python scripts into a python <strong>package</strong>. Individual *.py scripts can't be packaged on their own, you must add them to a directory which will represent your package. For example, the <code>foobar</code> package directory is as follows:</p>
<div class="highlight"><pre><span></span>...foobar\
    ...main.py
    ...util.py
    ...__init__.py
    ...etc.
</pre></div>


<p>The <code>__init__.py</code> is needed so that python treats your directory as a package. It can be either left totally blank or consist of helpful imports if you need them. The rest of your code also needs to be adjusted as every module is contained in a package now. So for example, the following main module won't work because the imported module (util) resides in a package now.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">util</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">print_line</span><span class="p">())</span>
</pre></div>


<p>This code must be re-factored so that it imports the util module from the foobar package instead:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">foobar</span> <span class="kn">import</span> <span class="n">util</span>
</pre></div>


<p>Of course, this must be done in each module. When your package gets installed on the user's machine, the scripts will be inside a directory such as following:</p>
<div class="highlight"><pre><span></span>C:\Users\&lt;username&gt;\AppData\Local\Programs\Python\Python36-32\Lib\site-packages\foobar\
</pre></div>


<p>And the user may be running the scripts from any random directory such as <code>C:\source</code> and there won't be a <code>util.py</code> on their current path obviously! Hence, the module must be referred to by its global package naming convention. Since <code>foobar</code> package will be installed on the user's machine, the above directory will be recognized by the python interpreter as <code>foobar</code> package directory where it will find <code>util</code> and other installed modules.</p>
<p>Once you do that, you must create a <code>setup.py</code> in the root directory of your source, so your directory structure becomes like this:</p>
<div class="highlight"><pre><span></span>setup.py
...foobar\
    ...main.py
    ...util.py
    ...__init__.py
    ...etc.
</pre></div>


<p>If you manage multiple projects in your source directory, you can put this whole bunch of files in a "foobar_project" or similarly named directory for organization.</p>
<p>You may add many other files at the root level such as <code>MAINFEST.in</code> which is only needed in case you want to add configuration or other files from different locations to your setup file. There could be other files too such as <code>README.md</code> for your project's description and your project's <code>LICENSE</code> file.</p>
<p>The contents of the <code>setup.py</code> should be as follows:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">foobar</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="n">foobar</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.1&quot;</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="s2">&quot;MIT&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Dummy package called foobar&quot;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="s2">&quot;Dummy package called foobar, some longer description.&quot;</span><span class="p">,</span>
    <span class="n">long_description_content_type</span><span class="o">=</span><span class="s1">&#39;text/markdown&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://github.com/prahladyeri/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pkg_name</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;console_scripts&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;foobar = foobar.main:main&quot;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;requests&#39;</span><span class="p">,</span> <span class="s1">&#39;colorama&#39;</span><span class="p">],</span>
    <span class="n">python_requires</span> <span class="o">=</span> <span class="s2">&quot;&gt;= 3.4&quot;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Prahlad Yeri&quot;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s2">&quot;prahladyeri@yahoo.com&quot;</span><span class="p">,</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;Programming Language :: Python :: 3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;License :: OSI Approved :: MIT License&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Operating System :: OS Independent&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">)</span>
</pre></div>


<p>The <code>setup</code> function takes some arguments which is basically the information needed to build and install your package. The most important argument is <code>name</code>, this is how your package will be identified by the pip installer and the python packaging index (pypi). For things like version number, license, description, etc., its a better idea to define those variables in <code>__init__.py</code> itself, so that you can directly import them like this instead of hard coding:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">foobar</span> <span class="kn">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">__description__</span><span class="p">,</span> <span class="n">__license__</span>
</pre></div>


<p>An important parameter here is <code>entry_points</code>. You must define the command line script name here which your user will use to run your script. If its going to be <code>foobar</code>, you must also specify which module's function must be called as entry point. In this case, when user runs <code>foobar</code>, the package foobar's main module will be called and from that, the main() function will run:</p>
<div class="highlight"><pre><span></span>    entry_points={
        &quot;console_scripts&quot;: [
            &quot;foobar = foobar.main:main&quot;,
        ],
    },
</pre></div>


<p>Of course, you must refactor your code so that it cannot simply start running from "<strong>main</strong>" check but must be placed in a separate main function:</p>
<div class="highlight"><pre><span></span>def main():
    pass # &lt;your code goes here

if __name__ == &quot;__main__&quot;:
    main()
</pre></div>


<p>You can also pass command arguments arguments through this arrangement but its better to use the <code>argparse</code> module for that instead of parsing the CLI arguments manually. Once you've done this wiring of your code properly as described, you then have to just run the following command to test your build by going to the package root directory (where setup.py is located):</p>
<div class="highlight"><pre><span></span>python setup.py sdist
</pre></div>


<p>The <code>sdist</code> argument creates a source distribution (typically tar.gz file) under the <code>dist</code> subdirectory. It will be of the format:</p>
<div class="highlight"><pre><span></span>foobar-&lt;version&gt;.tar.gz
</pre></div>


<p>Here, <version> is whatever you provide in the setup argument. You can test the installation of this build by running:</p>
<div class="highlight"><pre><span></span>pip install dist\foobar-&lt;version&gt;.tar.gz
</pre></div>


<p>This must install your package on the local machine, it will have the same effect as if your package was installed by pip itself:</p>
<div class="highlight"><pre><span></span>pip install foobar
</pre></div>


<p>Of course, you cannot run the above command until you upload your foobar package to the python package index (pypi). If you don't want to do that and just distribute zipped installation files to your users/clients, what you've learned until now should suffice. But if you want to upload your own package to pypi, then you must install a dependency library called <code>twine</code> for that:</p>
<div class="highlight"><pre><span></span>pip install twine
</pre></div>


<p>Now you are ready to upload your own package to python package index (pypi). For that, you must first register an account at <a href="https://pypi.org">python package index (pypi)</a>. After that, its as easy as running the <code>twine upload</code> command!</p>
<div class="highlight"><pre><span></span>twine upload dist\foobar-&lt;version&gt;.tar.gz
</pre></div>


<p>The above command asks your pypi login credentials you just registered and then upload your package. Within a few minutes, your package will be available for the whole world to install through pip!</p>
<div class="highlight"><pre><span></span>pip install foobar
</pre></div>
  </div><!-- /.entry-content -->

	<!-- Start: Prahlad -->
	<script>
	document.addEventListener('DOMContentLoaded', function(){
		console.log('DOMContentLoaded');
		var elems = document.querySelectorAll(".entry-content table");
		for(var i= 0;i<elems.length;i++) {
			if (!hasClass(elems[i], 'table')) addClass(elems[i], 'table');
			if (!hasClass(elems[i], 'table-bordered')) addClass(elems[i], 'table-bordered');
			if (!hasClass(elems[i], 'table-sm')) addClass(elems[i], 'table-sm');
		}
		document.querySelector(".entry-content img").parentElement.style.textAlign = "center";
	});
	</script>

	<!--start: adsense-->
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0428291735937735"
     crossorigin="anonymous"></script>
	<!-- prahladyeri.github.io -->
	<ins class="adsbygoogle"
		 style="display:block"
		 data-ad-client="ca-pub-0428291735937735"
		 data-ad-slot="9729062115"
		 data-ad-format="auto"
		 data-full-width-responsive="true"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	<!--end: adsense-->
	
	
	
	<!-- End: Prahlad -->
</section>
</div>
</div>


<footer id ="footer" class="text-center">
Copyright (&copy;) 2014-2023 Prahlad Yeri.<br>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</footer>

<script>
function hasClass(ele,cls) {
  return !!ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}
</script>

</body>
</html>