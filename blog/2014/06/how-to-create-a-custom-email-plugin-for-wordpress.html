<!DOCTYPE html>
<html lang="en">
<head>
  	<meta charset="utf-8" />
	<title>How to create a custom email plugin for Wordpress</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" property="og:description" content="Last week, I suddenly stopped receiving email notifications for my openshift hosted blog. I came to know after some reading that commonly used cloud hosts such as openshift, aws, etc. are usually blacklisted by most email servers, hence its not a good idea to use them to send mails. In …">
	<link rel="canonical" content="https://prahladyeri.github.io/blog/2014/06/how-to-create-a-custom-email-plugin-for-wordpress.html" />
	<meta name="author" content="Prahlad Yeri">
	<!-- Google Fonts -->
	<!--link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300&display=swap" rel="stylesheet"-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<link rel="stylesheet" href="/theme/css/app.css">
	<link rel="stylesheet" href="/theme/css/pygment.css">		
	<link rel="shortcut icon" type="image/x-icon" href="/uploads/py.png" />
	<link href="https://prahladyeri.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Full Atom Feed" />
	<link href="https://prahladyeri.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Prahlad Yeri's Blog Full RSS Feed" />
	<link href="https://prahladyeri.github.io/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Categories Atom Feed" />




    <meta name="tags" content="PHP" />
    <meta name="tags" content="Wordpress" />
    <meta name="tags" content="Email" />
    <meta name="tags" content="How To" />

	
	
	
	<!-- twitter card meta data -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@prahladyeri" />
	<meta name="twitter:creator" content="@prahladyeri" />
		<meta name="twitter:url" content="https://prahladyeri.github.io/blog/2014/06/how-to-create-a-custom-email-plugin-for-wordpress.html" />
		<meta name="twitter:title" content="How to create a custom email plugin for Wordpress" />
		<meta name="twitter:description" content="Last week, I suddenly stopped receiving email notifications for my openshift hosted blog. I came to know after some reading that commonly used cloud hosts such as openshift, aws, etc. are usually blacklisted by most email servers, hence its not a good idea to use them to send mails. In …" />
			<meta name="twitter:image" content="https://prahladyeri.github.io/uploads/cover.jpg" />
			<meta name="image" property="og:image" content="https://prahladyeri.github.io/uploads/cover.jpg">

	
	<!--start: analytics -->
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-6808883-5"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-6808883-5');
	</script>
	<!--end: analytics -->
	
<!--pinterest claim-->
<meta name="p:domain_verify" content="eb43d46309e2766ef1b627cea2d19326"/>
</head>

<body id="index" class="home">
<!-- section bootstrap-menu -->
<div class='container'>
<div class='row header'>
	<div class='col-md-12 text-center' style='margin: 10px 0 0 0'>
		<h2>Prahlad Yeri</h2>
		<h6 class='text-muted'>Freelance Programmer and Writer</h6>
	</div>
	<div class='col-md-12 text-center' >
		<ul class="nav nav-fill text-center site-links col-md-8 ml-auto mr-auto">
		<li class="nav-item"><a class="nav-link btn btn-primary" href="/">Home</a></li>
		<li class="nav-item"><a class="nav-link btn btn-success" href="/blog">Blog</a></li>
		<li class="nav-item"><a class="nav-link btn btn-danger" href="/portfolio">Portfolio</a></li>
		<li class="nav-item"><a class="nav-link btn btn-secondary" href="https://github.com/prahladyeri/resume">Resume</a></li>
		<li class="nav-item"><a class="nav-link btn btn-warning" href="/hire-me">Hire Me</a></li>
		<li class='nav-item dropdown'>
			<a class="nav-link dropdown-toggle btn btn-dark" id='btnSocial' href="javascript:" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Social</a>
			<div class="dropdown-menu" aria-labelledby="btnSocial">
				<a class="dropdown-item" href="https://twitter.com/prahladyeri">Twitter</a>
				<a class="dropdown-item" href="https://github.com/prahladyeri">Github</a>
				<a class="dropdown-item" href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a>
				<a class="dropdown-item" href="https://prahladyeri.medium.com/">Medium</a>
				<a class="dropdown-item" href="https://www.quora.com/profile/Prahlad-Yeri">Quora</a>
				<a class="dropdown-item" href="https://www.instagram.com/prahladyeri14/">Instagram</a>
				<a class="dropdown-item" href="mailto:prahladyeri@yahoo.com">Email</a>
			</div>
		</li>
		<li class='btn-group'>
			<a class="nav-link dropdown-toggle btn btn-info" role='button' id='btnFeeds' href="javascript:" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Feeds</a>
			<div class="dropdown-menu" aria-labelledby="btnFeeds">
				<a class="dropdown-item" href="/feeds/all.rss.xml">RSS</a>
				<a class="dropdown-item" href="/feeds/all.atom.xml">ATOM</a>
				<!-- <a class="dropdown-item" href="https://feedburner.google.com/fb/a/mailverify?uri=prahladyeri&amp;loc=en_US">Feedburner</a> -->
			</div>
		</li>
		</ul>
	</div>
</div>

<div class='row'>
	<div class='ml-auto col-md-8 mr-auto'>
	</div>
</div>
</div>

		<div id="main" class='mt-2 container content '>
			<div class='row'>
				<div class='offset-md-2 col-md-8'>
<section id="content" class="body">
  <header>
    <h1 class="entry-title">
      <span class="text-secondary" href="https://prahladyeri.github.io/blog/2014/06/how-to-create-a-custom-email-plugin-for-wordpress.html" rel="bookmark" 
      title="Permalink to How to create a custom email plugin for Wordpress">How to create a custom email plugin for Wordpress</span></h1>
 
  </header>
  <footer class="post-info clearfix">
	<span class='float-sm-none float-md-left'>
    <time class="text-muted published" datetime="2014-06-07T10:39:00+05:30">Sat 07 June 2014</time>
    <div class="text-muted vcard author">
      By           <a class="url fn" href="https://prahladyeri.github.io/">Prahlad Yeri</a>
    </div>
	</span>
	<div class='float-sm-none float-md-right'>
    <div class="text-muted category text-right">
        Filed under <a href="https://prahladyeri.github.io/blog/category/php">PHP</a>
    </div>
    <div class="text-muted tags">
		Tags
            <a href="https://prahladyeri.github.io/blog/tag/php">PHP</a>
            <a href="https://prahladyeri.github.io/blog/tag/wordpress">Wordpress</a>
            <a href="https://prahladyeri.github.io/blog/tag/email">Email</a>
            <a href="https://prahladyeri.github.io/blog/tag/how-to">How To</a>
    </div>
	</div>
  </footer><!-- /.post-info -->
  <br>
  <div class="entry-content">
    <p>Last week, I suddenly stopped receiving email notifications for my <a href="https://www.openshift.com/">openshift</a> hosted blog. I came to know after some <a href="http://stackoverflow.com/questions/17583205/sendmail-on-openshift-php-codeigniter/17598537#17598537">reading</a> that commonly used cloud hosts such as openshift, aws, etc. are usually blacklisted by most email servers, hence its not a good idea to use them to send mails.<!--more--></p>
<p>In any case, why should I depend on my hosting provider for email sending. Until now, I had never bothered about how mail sending worked in wordpress as it used to work out of the box. So last week, I pulled up my socks and decided to put my php <a href="http://en.wikipedia.org/wiki/Geany">IDE</a> and <a href="http://en.wikipedia.org/wiki/Xdebug">debugger</a> to some good work.</p>
<p>I decided to use my <a href="https://sendgrid.com">sendgrid</a> account to send mails. All that`s needed now is calling the web service with the credentials they've provided. But how to integrate this with my wordpress blog?</p>
<p>Once I located <strong><em>where</em></strong> the mail sending functionality is there in wordpress code, adding a new method was a piece of cake!! Turns out that wordpress, by default, just executes the "mail" command which is usually just a symlink on unix boxes actually pointing to <em>/usr/bin/sendmail</em> or something. I found it in a pluggable function <em>wp_mail()</em>. (see <em>/wp-includes/pluggable.php</em>). I also came to know from the codex that <a href="http://codex.wordpress.org/Pluggable_Functions">pluggable functions</a> can be easily overridden by plugins.</p>
<p>Now all I had to do was write a small plugin in the /wp-content/plugins/sendgrid/ folder and override this wp_mail() function with whatever I want.</p>
<p>Lo and behold! I started receiving notifications for all comments and contact forms filled, by just writing this one plugin. I found the process so simple and easy to integrate with wordpress that I couldn't help sharing with you. Here are the two php snippets that you need to place in /wp-content/plugins/<em>your-plugin-name</em>/ and activate it. <em>Wordpress</em> will do the rest!</p>
<p>(First one is the main plugin php file that displays the plugin in your admin menu and overrides the wp_mail function. The second php file contains the actual custom function that sends email via sendgrid.)</p>
<p><em>wp-content/plugins/sendgrid/myplugin.php:</em></p>
<div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span> <span class="cm">/**</span>
<span class="cm"> * Plugin Name: Sendgrid Plugin</span>
<span class="cm"> * Plugin URI:  http://prahladyeri.github.io</span>
<span class="cm"> * Description: Mail sending using Sendgrid Web API</span>
<span class="cm"> * Version:     0.1</span>
<span class="cm"> * Author:      Prahlad Yeri</span>
<span class="cm"> * Author URI:  http://prahladyeri.github.io</span>
<span class="cm"> * License:     MIT</span>
<span class="cm"> */</span>

<span class="c1">//namespace MailDemo;</span>
<span class="nx">require_once</span><span class="p">(</span><span class="s1">&#39;sendgrid.php&#39;</span><span class="p">);</span>

<span class="nx">add_action</span><span class="p">(</span> <span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;plugin_init&#39;</span> <span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Plugin Name: Prahlad&#39;s mail</span>
<span class="cm"> * Description: Alternative way to send a mail</span>
<span class="cm"> */</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">function_exists</span><span class="p">(</span><span class="s1">&#39;wp_mail&#39;</span><span class="p">))</span> 
<span class="p">{</span>
    <span class="kd">function</span> <span class="nx">wp_mail</span><span class="p">(</span><span class="nx">$to</span><span class="p">,</span> <span class="nx">$subject</span><span class="p">,</span> <span class="nx">$message</span><span class="p">,</span> <span class="nx">$headers</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">$attachments</span> <span class="o">=</span> <span class="nx">array</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="nx">$sto</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="nx">$to</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nx">$sto</span> <span class="o">=</span> <span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nx">$to</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">$sto</span> <span class="o">=</span> <span class="nx">$to</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">sendgridmail</span><span class="p">(</span><span class="s1">&#39;wpadmin@mywebsite.com&#39;</span><span class="p">,</span> <span class="nx">$sto</span><span class="p">,</span> <span class="nx">$subject</span><span class="p">,</span> <span class="nx">$message</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">plugin_init</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>


<p><em>wp-content/plugins/sendgrid/sendgrid.php:</em></p>
<div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span> <span class="c1">//wp-content/plugins/sendgrid/sendgrid.php</span>
<span class="kd">function</span> <span class="nx">sendgridmail</span><span class="p">(</span><span class="nx">$from</span><span class="p">,</span> <span class="nx">$to</span><span class="p">,</span> <span class="nx">$subject</span><span class="p">,</span> <span class="nx">$message</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">)</span> <span class="p">{</span>        
<span class="nx">$url</span> <span class="o">=</span> <span class="s1">&#39;https://api.sendgrid.com/&#39;</span><span class="p">;</span>
<span class="nx">$user</span><span class="o">=</span><span class="s1">&#39;your-sendgrid-username&#39;</span><span class="p">;</span>   
<span class="nx">$pass</span><span class="o">=</span><span class="s1">&#39;your-sendgrid-password&#39;</span><span class="p">;</span>

<span class="nx">$params</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span>       
<span class="s1">&#39;api_user&#39;</span>  <span class="o">?&gt;</span> <span class="nx">$user</span><span class="p">,</span>
        <span class="s1">&#39;api_key&#39;</span>   <span class="o">=&gt;</span> <span class="nx">$pass</span><span class="p">,</span>
        <span class="s1">&#39;to&#39;</span>        <span class="o">=&gt;</span> <span class="nx">$to</span><span class="p">,</span>
        <span class="s1">&#39;subject&#39;</span>   <span class="o">=&gt;</span> <span class="nx">$subject</span><span class="p">,</span>
        <span class="s1">&#39;html&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;text&#39;</span>      <span class="o">=&gt;</span> <span class="nx">$message</span><span class="p">,</span>
        <span class="s1">&#39;from&#39;</span>      <span class="o">=&gt;</span> <span class="nx">$from</span><span class="p">,</span>
      <span class="p">);</span>


    <span class="nx">$request</span> <span class="o">=</span>  <span class="nx">$url</span><span class="p">.</span><span class="s1">&#39;api/mail.send.json&#39;</span><span class="p">;</span>

    <span class="c1">// Generate curl request</span>
    <span class="nx">$session</span> <span class="o">=</span> <span class="nx">curl_init</span><span class="p">(</span><span class="nx">$request</span><span class="p">);</span>
    <span class="c1">// Tell curl to use HTTP POST</span>
    <span class="nx">curl_setopt</span> <span class="p">(</span><span class="nx">$session</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="c1">// Tell curl that this is the body of the POST</span>
    <span class="nx">curl_setopt</span> <span class="p">(</span><span class="nx">$session</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nx">$params</span><span class="p">);</span>
    <span class="c1">// Tell curl not to return headers, but do return the response</span>
    <span class="nx">curl_setopt</span><span class="p">(</span><span class="nx">$session</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="nx">curl_setopt</span><span class="p">(</span><span class="nx">$session</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

    <span class="nx">print_r</span><span class="p">(</span><span class="s1">&#39;obtaining the response&#39;</span><span class="p">);</span>
    <span class="c1">// obtain response</span>
    <span class="nx">$response</span> <span class="o">=</span> <span class="nx">curl_exec</span><span class="p">(</span><span class="nx">$session</span><span class="p">);</span>
    <span class="nx">print_r</span><span class="p">(</span><span class="s1">&#39;closing curl session&#39;</span><span class="p">);</span>
    <span class="nx">curl_close</span><span class="p">(</span><span class="nx">$session</span><span class="p">);</span>

    <span class="c1">// print everything out</span>
    <span class="c1">//print_r($response);</span>
<span class="p">}</span>

<span class="c1">//only for testing:</span>
<span class="cm">/*$to      = &#39;prahladyeri@yahoo.com&#39;;</span>
<span class="cm">$subject = &#39;Testemail&#39;;</span>
<span class="cm">$message = &#39;It works!!&#39;;</span>
<span class="cm">echo &#39;To is: &#39; + $to;</span>
<span class="cm">#wp_mail($to, $subject, $message, array() );</span>
<span class="cm">sendgridmail($to, $subject, $message, array());</span>
<span class="cm">print_r(&#39;Just sent!&#39;);*/</span>
</pre></div>


<p><em>References:</em></p>
<ol>
<li><a href="http://codex.wordpress.org/Pluggable_Functions">http://codex.wordpress.org/Pluggable_Functions</a></li>
<li><a href="http://stackoverflow.com/q/17583205/849365#17598537">http://stackoverflow.com/q/17583205/849365#17598537</a></li>
<li><a href="http://codex.wordpress.org/Pluggable_Functions">http://codex.wordpress.org/Pluggable_Functions</a></li>
<li><a href="http://en.wikipedia.org/wiki/Geany">http://en.wikipedia.org/wiki/Geany</a></li>
<li><a href="http://en.wikipedia.org/wiki/Xdebug">http://en.wikipedia.org/wiki/Xdebug</a></li>
<li><a href="https://sendgrid.com">https://sendgrid.com</a></li>
<li><a href="https://sendgrid.com/docs/">https://sendgrid.com/docs/</a></li>
<li><a href="https://www.openshift.com/">https://www.openshift.com/</a></li>
</ol>
  </div><!-- /.entry-content -->

	<!-- Start: Prahlad -->
	<script>
	$(document).ready(function(){
		$(".entry-content table").addClass("table table-bordered table-sm");
		$(".entry-content img").parent().css({'text-align': 'center'});
	});
	</script>

	<!--start: adsense-->
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0428291735937735"
     crossorigin="anonymous"></script>
	<!-- prahladyeri.github.io -->
	<ins class="adsbygoogle"
		 style="display:block"
		 data-ad-client="ca-pub-0428291735937735"
		 data-ad-slot="9729062115"
		 data-ad-format="auto"
		 data-full-width-responsive="true"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	<!--end: adsense-->
	
	
	
	<!-- End: Prahlad -->
</section>
				</div>
				<div class='col-md-2 amz-block-right '> <!--align-self-center-->
					<div style='margin-top: 50px;'>

<!-- AMAZON AFFILIATE ADS -->
<!--
<a href="https://www.amazon.in/Automate-Boring-Stuff-Python-2nd/dp/1593279922/ref=as_li_ss_il?crid=JA705IOUH74O&keywords=automate+the+boring+stuff+with+python&qid=1583912586&sprefix=automate+the+,aps,460&sr=8-1&linkCode=li2&tag=prahladyeri-21&linkId=5f899269cc1aea74977c02963a9a6caf&language=en_IN" target="_blank"><img border="0" src="//ws-in.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=1593279922&Format=_SL160_&ID=AsinImage&MarketPlace=IN&ServiceVersion=20070822&WS=1&tag=prahladyeri-21&language=en_IN" ></a><img src="https://ir-in.amazon-adsystem.com/e/ir?t=prahladyeri-21&language=en_IN&l=li2&o=31&a=1593279922" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<a href="https://www.amazon.in/PYTHON-PROGRAMMING-BEGINNERS-GUIDE-LEARN-ebook/dp/B01GSODGZC/ref=as_li_ss_il?crid=33LIIMVDMW1U3&keywords=python+programming&qid=1583912662&sprefix=python,aps,527&sr=8-4&linkCode=li2&tag=prahladyeri-21&linkId=6b3a8b38eda1d6c51546a1a0c321cfea&language=en_IN" target="_blank"><img border="0" src="//ws-in.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B01GSODGZC&Format=_SL160_&ID=AsinImage&MarketPlace=IN&ServiceVersion=20070822&WS=1&tag=prahladyeri-21&language=en_IN" ></a><img src="https://ir-in.amazon-adsystem.com/e/ir?t=prahladyeri-21&language=en_IN&l=li2&o=31&a=B01GSODGZC" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
-->

					</div>
				</div>
			</div>
		</div>

<div class='container-fluid'>
<div class='row'>
		<footer id ="footer" class="col-md-12 text-center bg-dark text-white pt-1 pb-1 pl-1 pr-1">
		Copyright (&copy;) 2014-2022 Prahlad Yeri. This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
		</footer>
</div>
</div>		

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<!-- <script src="/theme/js/popper.min.js"></script> -->
<!-- <script src="/theme/js/bootstrap.min.js"></script> -->
</body>
</html>