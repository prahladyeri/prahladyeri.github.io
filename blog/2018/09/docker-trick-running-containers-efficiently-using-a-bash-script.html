<!DOCTYPE html>
<html lang="en">
<head>
  	<meta charset="utf-8" />
	<title>Docker trick: Running containers efficiently using a bash script</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" property="og:description" content="One of the basic problems with running a docker image is that its too easy to spew up multiple instances or containers of the same image. Consider running the following container for instance: docker run -it -e AWS_ACCESS_KEY_ID="test" -e AWS_SECRET_ACCESS_KEY="test" \ --net=host "prahladyeri/testimage:latest" /bin/bash This â€¦">
	<link rel="canonical" content="https://prahladyeri.github.io/blog/2018/09/docker-trick-running-containers-efficiently-using-a-bash-script.html" />
	<meta name="author" content="Prahlad Yeri">
	<link rel="stylesheet" href="/theme/css/app.css?v=1.15">
	<link rel="stylesheet" href="/theme/css/pygment.css">
	<link rel="shortcut icon" type="image/x-icon" href="/uploads/py.webp" />
	<link href="https://prahladyeri.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Full Atom Feed" />
	<link href="https://prahladyeri.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Prahlad Yeri's Blog Full RSS Feed" />
	<link href="https://prahladyeri.github.io/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Categories Atom Feed" />




    <meta name="tags" content="Docker" />
    <meta name="tags" content="Linux" />

	
	<!-- fosstodon verify -->
	<a style='display:none'  rel="me" href="https://fosstodon.org/@prahladyeri">Fosstodon</a>
	<!-- mastodon verify -->
	<a style='display:none' rel="me" href="https://mastodon.social/@prahladyeri">Mastodon</a>
	
	<!-- pinterest verify -->
	<meta name="p:domain_verify" content="a57360faef2ee56807b63d62092a849a"/>
	
	<!-- twitter card meta data -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@prahladyeri" />
	<meta name="twitter:creator" content="@prahladyeri" />
		<meta name="twitter:url" content="https://prahladyeri.github.io/blog/2018/09/docker-trick-running-containers-efficiently-using-a-bash-script.html" />
		<meta name="twitter:title" content="Docker trick: Running containers efficiently using a bash script" />
		<meta name="twitter:description" content="One of the basic problems with running a docker image is that its too easy to spew up multiple instances or containers of the same image. Consider running the following container for instance: docker run -it -e AWS_ACCESS_KEY_ID="test" -e AWS_SECRET_ACCESS_KEY="test" \ --net=host "prahladyeri/testimage:latest" /bin/bash This â€¦" />
			<meta name="twitter:image" content="https://prahladyeri.github.io/uploads/cover.jpg" />
			<meta name="image" property="og:image" content="https://prahladyeri.github.io/uploads/cover.jpg">

	
	
</head>

<body>
<div id='header'>
<div class='text-center' >
	<h1 class='blog-title'>Prahlad Yeri</h1>
	<h4  class='blog-tagline'>Freelance Programmer and Writer</h4>
</div>

<div id='navBlock' class='text-center' >
	<a class="nav-link" href="/">Home</a> | 
	<a class="nav-link" href="/blog">Blog</a> | 
	<a class="nav-link" href="/portfolio">Portfolio</a> | 
	<a class="nav-link" href="https://github.com/prahladyeri/resume">Resume</a> | 
	<a class="nav-link" href="/hire-me">Hire Me</a>
	<br>
	Social:
	<a class="nav-link" href="https://github.com/prahladyeri">Github</a> | 
	<a class="nav-link" href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a> | 
	<a class="nav-link" href="https://twitter.com/prahladyeri">Twitter</a> | 
	<a class="nav-link" href="https://prahladyeri.medium.com/">Medium</a>
	<br>ðŸ“© prahladyeri at yahoo dot com | 
	<a class="nav-link" href="/feeds/all.rss.xml">RSS</a> | 
	<a class="nav-link" href="/feeds/all.atom.xml">ATOM</a>
</div>
</div>
<div id="main" class='row content '>
<div class='col w50 m-auto'>
<section id="content" class="body">
  <header>
	<h1 class='mt-4 mb-4 post-title'>Docker trick: Running containers efficiently using a bash script</h1>
 
  </header>
  <footer class="post-info clearfix">
	<span class='float-left'>
    <time class="text-muted published" datetime="2018-09-14T10:59:00+05:30">2018-09-14</time>
    <div class="text-muted vcard author">
      By           <a class="url fn" href="https://prahladyeri.github.io/">Prahlad Yeri</a>
    </div>
	</span>
	<div class='float-right'>
    <div class="text-muted category text-right">
        Filed under <a href="https://prahladyeri.github.io/blog/category/technology">Technology</a>
    </div>
    <div class="text-muted tags">
		Tags
            <a href="https://prahladyeri.github.io/blog/tag/docker">Docker</a>
            <a href="https://prahladyeri.github.io/blog/tag/linux">Linux</a>
    </div>
	</div>
  </footer><!-- /.post-info -->
  
  <div class="entry-content">
    <p>One of the basic problems with running a docker image is that its too easy to spew up multiple instances or containers of the same image. Consider running the following container for instance:</p>
<div class="highlight"><pre><span></span>docker run -it -e AWS_ACCESS_KEY_ID=&quot;test&quot; -e AWS_SECRET_ACCESS_KEY=&quot;test&quot; \
--net=host &quot;prahladyeri/testimage:latest&quot; /bin/bash
</pre></div>


<p>This will start a fresh container instance from image <strong>prahladyeri/testimage:latest</strong> and you may optionally pass environment variables (using -e switch), and the /bin/bash argument to manually trigger a command inside the container instead of running the default one. However, once you exit the container, you don't have any control over that container <em>instance</em>. Running the same "docker run" command as above is just going to spew another container instance for the same image, while the old one still stays in memory. Repeating this process multiple times is a wastage of invaluable memory and cores which isn't the goal of using docker at all!</p>
<p><img alt="docker-logo" class="alignnone size-medium wp-image-1073" height="232" src="/uploads/2018/09/docker-logo-300x232.png" width="300"></p>
<p>A more efficient way of handling things is to check the existence of a container instance already running for the image, and restart that one if required:</p>
<div class="highlight"><pre><span></span>docker ps -a -f &quot;ancestor=prahladyeri/testimage:latest&quot; -q -l
f7261ea890ce
</pre></div>


<p>The above command returns the id of an already running container (if any), so using that you can just restart that same container without passing all the parameters again as follows:</p>
<div class="highlight"><pre><span></span>docker start -i f7261ea890ce
</pre></div>


<p>Of course, you can automate this whole process by writing a single bash script called <em>start_container:</em></p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">imgname</span><span class="o">=</span><span class="s2">&quot;prahladyeri/testimage:latest&quot;</span>
<span class="nv">imgid</span><span class="o">=</span><span class="k">$(</span>docker ps -a -f <span class="s2">&quot;ancestor=</span><span class="nv">$imgname</span><span class="s2">&quot;</span> -q -l<span class="k">)</span>

<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$imgid</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;creating new instance for </span><span class="nv">$imgname</span><span class="s2">&quot;</span>
  docker run -it -e <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">&quot;test&quot;</span> -e <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">&quot;test&quot;</span> --net<span class="o">=</span>host <span class="s2">&quot;</span><span class="nv">$imgname</span><span class="s2">&quot;</span> /bin/bash
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">&quot;instance found&quot;</span>
  docker start -i <span class="k">$(</span>docker ps -a -f <span class="s2">&quot;ancestor=</span><span class="nv">$imgname</span><span class="s2">&quot;</span> -q -l<span class="k">)</span>
<span class="k">fi</span>
</pre></div>


<p>Just replace the \$<em>imgname</em> variable with that of your own image name, and pass any arguments you want (for example, <strong><em>-e AWS_KEY_ID</em></strong>) to the container on line 7. This script will start a new container only if none are found already, otherwise, it will just restart an existing one!</p>
<p>Hope you find this useful.</p>
  </div><!-- /.entry-content -->

	<!-- Start: Prahlad -->
	<script>
	document.addEventListener('DOMContentLoaded', function(){
		console.log('DOMContentLoaded');
		var elems = document.querySelectorAll(".entry-content table");
		for(var i= 0;i<elems.length;i++) {
			if (!hasClass(elems[i], 'table')) addClass(elems[i], 'table');
			if (!hasClass(elems[i], 'table-bordered')) addClass(elems[i], 'table-bordered');
			if (!hasClass(elems[i], 'table-sm')) addClass(elems[i], 'table-sm');
		}
		document.querySelector(".entry-content img").parentElement.style.textAlign = "center";
	});
	</script>

	<!--start: adsense-->
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0428291735937735"
     crossorigin="anonymous"></script>
	<!-- prahladyeri.github.io -->
	<ins class="adsbygoogle"
		 style="display:block"
		 data-ad-client="ca-pub-0428291735937735"
		 data-ad-slot="9729062115"
		 data-ad-format="auto"
		 data-full-width-responsive="true"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	<!--end: adsense-->
	
	
	
	<!-- End: Prahlad -->
</section>
</div>
<!-- <div id='push'></div> -->
</div>


<footer id ="footer" class="text-center">
<br>
Copyright (&copy;) 2014-2023 Prahlad Yeri. Build 1.15.<br>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</footer>

<script>
function hasClass(ele,cls) {
  return !!ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

document.addEventListener('DOMContentLoaded', function() {
	//var hh = document.querySelector("#header").clientHeight;
	//var fh = document.querySelector("#footer").clientHeight;
	//document.querySelector("#main").style.height = "calc(100vh - " + (hh + fh) + "px);"
});
</script>

</body>
</html>