<!DOCTYPE html>
<html lang="en">
<head>
  	<meta charset="utf-8" />
	<title>How to use Bash+rsync to automate your periodical backups on Linux</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" property="og:description" content="Linux is all about simplicity. Simple and time-tested tools like iptables, netstat and rsync can be called for help for basic tasks instead of untrusted third-party tools as happens in case of Windows. If you are a desktop user, then taking frequent backups of your data to a pen-drive or …">
	<link rel="canonical" content="https://prahladyeri.github.io/blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html" />
	<meta name="author" content="Prahlad Yeri">
	<link rel="stylesheet" href="/theme/css/app.css?v=1.4">
	<link rel="stylesheet" href="/theme/css/pygment.css">		
	<link rel="shortcut icon" type="image/x-icon" href="/uploads/py.png" />
	<link href="https://prahladyeri.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Full Atom Feed" />
	<link href="https://prahladyeri.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Prahlad Yeri's Blog Full RSS Feed" />
	<link href="https://prahladyeri.github.io/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Categories Atom Feed" />




    <meta name="tags" content="Backup" />
    <meta name="tags" content="Linux" />
    <meta name="tags" content="Ubuntu" />
    <meta name="tags" content="How To" />

	
	<!-- fosstodon verify -->
	<a style='display:none'  rel="me" href="https://fosstodon.org/@prahladyeri">Fosstodon</a>
	<!-- mastodon verify -->
	<a style='display:none' rel="me" href="https://mastodon.social/@prahladyeri">Mastodon</a>
	
	<!-- pinterest verify -->
	<meta name="p:domain_verify" content="a57360faef2ee56807b63d62092a849a"/>
	
	<!-- twitter card meta data -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@prahladyeri" />
	<meta name="twitter:creator" content="@prahladyeri" />
		<meta name="twitter:url" content="https://prahladyeri.github.io/blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html" />
		<meta name="twitter:title" content="How to use Bash+rsync to automate your periodical backups on Linux" />
		<meta name="twitter:description" content="Linux is all about simplicity. Simple and time-tested tools like iptables, netstat and rsync can be called for help for basic tasks instead of untrusted third-party tools as happens in case of Windows. If you are a desktop user, then taking frequent backups of your data to a pen-drive or …" />
			<meta name="twitter:image" content="https://prahladyeri.github.io/uploads/cover.jpg" />
			<meta name="image" property="og:image" content="https://prahladyeri.github.io/uploads/cover.jpg">

	
	
</head>

<body>
<div id='header'>
<div class='text-center' >
	<h1 class='blog-title'>Prahlad Yeri</h1>
	<h4  class='blog-tagline'>Freelance Programmer and Writer</h4>
</div>

<div id='navBlock' class='text-center' >
	<a class="nav-link" href="/">Home</a> | 
	<a class="nav-link" href="/blog">Blog</a> | 
	<a class="nav-link" href="/portfolio">Portfolio</a> | 
	<a class="nav-link" href="https://github.com/prahladyeri/resume">Resume</a> | 
	<a class="nav-link" href="/hire-me">Hire Me</a>
	<br>
	Social:
	<a class="nav-link" href="https://twitter.com/prahladyeri">Twitter</a> | 
	<a class="nav-link" href="https://github.com/prahladyeri">Github</a> | 
	<a class="nav-link" href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a> | 
	<a class="nav-link" href="https://prahladyeri.medium.com/">Medium</a> | 
	<a class="nav-link" href="https://www.quora.com/profile/Prahlad-Yeri">Quora</a>
	<br>
	Email: prahladyeri at yahoo dot com | 
	Feeds:
	<a class="nav-link" href="/feeds/all.rss.xml">RSS</a> | 
	<a class="nav-link" href="/feeds/all.atom.xml">ATOM</a>
</div>
</div>
<div id="main" class='row content '>
<div class='col w50 m-auto'>
<section id="content" class="body">
  <header>
	<h1 style='color: darkolivegreen;' class='mt-4 mb-4'>How to use Bash+rsync to automate your periodical backups on Linux</h1>
 
  </header>
  <footer class="post-info clearfix">
	<span class='float-left'>
    <time class="text-muted published" datetime="2018-03-04T13:05:00+05:30">Sun 04 March 2018</time>
    <div class="text-muted vcard author">
      By           <a class="url fn" href="https://prahladyeri.github.io/">Prahlad Yeri</a>
    </div>
	</span>
	<div class='float-right'>
    <div class="text-muted category text-right">
        Filed under <a href="https://prahladyeri.github.io/blog/category/linux">Linux</a>
    </div>
    <div class="text-muted tags">
		Tags
            <a href="https://prahladyeri.github.io/blog/tag/backup">Backup</a>
            <a href="https://prahladyeri.github.io/blog/tag/linux">Linux</a>
            <a href="https://prahladyeri.github.io/blog/tag/ubuntu">Ubuntu</a>
            <a href="https://prahladyeri.github.io/blog/tag/how-to">How To</a>
    </div>
	</div>
  </footer><!-- /.post-info -->
  
  <div class="entry-content">
    <p><strong>Linux</strong> is all about simplicity. Simple and time-tested tools like <code>iptables</code>, <code>netstat</code> and <code>rsync</code> can be called for help for basic tasks instead of untrusted third-party tools as happens in case of Windows. If you are a desktop user, then taking frequent backups of your data to a pen-drive or external disk is a typical problem to solve.<!--more--></p>
<p>In this article, I'll show how I solved this problem using a combination of <strong>bash scripting</strong> and <strong>rsync</strong>, the basic tooling available on any linux distro these days, be it Ubuntu, Debian or Fedora.</p>
<p>One of the things you may want to do is determine what folder(s) you want to backup to which device. You may want to copy the source code folder only to your pen drive and your images and documents to only external drive, for instance. Here is where identifying the disk label through bash comes in handy in the backup script:</p>
<div class="highlight"><pre><span></span>if [ -d &quot;/media/prahlad/DATA128&quot; ]; then
    device_name=&quot;DATA128&quot;
    folder_name=&quot;/media/prahlad/DATA128&quot;
elif [ -d &quot;/media/prahlad/extHD&quot; ]; then
    device_name=&quot;extHD&quot;
    folder_name=&quot;/media/prahlad/extHD&quot;
else
    echo &quot;No Drive Found&quot;
    exit
fi
</pre></div>


<p>In the above example, <strong>DATA128</strong> is a pen-drive and <strong>extHD</strong> is an external hard-drive and the above script determines which disk is inserted in the USB drive. You can then use the <strong>\$folder_name</strong> bash variable to dynamically copy to that device instead of hard-coding that path unnecessarily. You can also use <strong>\$device_name</strong> bash variable to include or skip specific folders when running the rsync command:</p>
<div class="highlight"><pre><span></span>rsync -va /home/prahlad/source &quot;$folder_name/source&quot;

if [ &quot;$device_name&quot; = &quot;extHD&quot; ]; then
 rsync -va /home/prahlad/Pictures &quot;$folder_name/home/Pictures&quot;
 rsync -va /home/prahlad/Documents &quot;$folder_name/home/Documents&quot;
fi
</pre></div>


<p>The <strong>rsync</strong> command itself is also versatile enough to do a lot of things which are not possible using a simple copy-paste-replace using a file manager. For instance, the "a" or "--archive" option intelligently archives (copies) files while skipping identical ones based on checksum or modification date automatically. Further, the "--delete" option deletes files which are present on the destination backup device, but not on the source device which is typically the case when you want to backup your data. Run "man rsync" to see the full range of options exposed by this wonderful command.</p>
<p>Finally, another advantage of using a script for backup automation is that you can implement custom actions through the script. For example, compressing the mozilla firefox user folder before taking its backup:</p>
<div class="highlight"><pre><span></span>echo &quot;backing up firefox...&quot;
tar czf ~/firefox-backup.tar.gz ~/.mozilla/firefox/
rsync -va ~/firefox-backup.tar.gz &quot;$folder_name/home/firefox-backup.tar.gz&quot;
</pre></div>


<p>Below is a typical example of how you might implement a script to automate backup of your home folder and set this as a cron job to run say weekly or fortnightly:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="k">if</span> <span class="o">[</span> -d <span class="s2">&quot;/media/prahlad/DATA128&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nv">device_name</span><span class="o">=</span><span class="s2">&quot;DATA128&quot;</span>
 <span class="nv">folder_name</span><span class="o">=</span><span class="s2">&quot;/media/prahlad/DATA128&quot;</span>
<span class="k">elif</span> <span class="o">[</span> -d <span class="s2">&quot;/media/prahlad/extHD&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nv">device_name</span><span class="o">=</span><span class="s2">&quot;extHD&quot;</span>
 <span class="nv">folder_name</span><span class="o">=</span><span class="s2">&quot;/media/prahlad/extHD&quot;</span>
<span class="k">else</span>
 <span class="nb">echo</span> <span class="s2">&quot;No Drive Found&quot;</span>
 <span class="nb">exit</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="s2">&quot;Device: </span><span class="nv">$device_name</span><span class="s2">&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Folder: </span><span class="nv">$folder_name</span><span class="s2">&quot;</span>

<span class="c1">#start copying </span>

<span class="c1">#home</span>
rsync -va ~/.bashrc <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/&quot;</span> --delete
rsync -va ~/.profile <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/&quot;</span> --delete
rsync -va ~/Downloads/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/Downloads/&quot;</span> --delete
rsync -va ~/Documents/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/Documents/&quot;</span> --delete
rsync -va ~/Pictures/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/Pictures/&quot;</span> --delete
rsync -va ~/.ssh/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/.ssh/&quot;</span> --delete
rsync -va ~/.gnupg/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/.gnupg/&quot;</span> --delete
rsync -va ~/.thunderbird/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/.thunderbird/&quot;</span> --delete
rsync -va ~/.mozilla/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/.mozilla/&quot;</span> --delete

<span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>
</pre></div>


<p>You can customize the above script by adding custom actions or if conditions to skip or include specific folders based on the device label.</p>
  </div><!-- /.entry-content -->

	<!-- Start: Prahlad -->
	<script>
	document.addEventListener('DOMContentLoaded', function(){
		console.log('DOMContentLoaded');
		var elems = document.querySelectorAll(".entry-content table");
		for(var i= 0;i<elems.length;i++) {
			if (!hasClass(elems[i], 'table')) addClass(elems[i], 'table');
			if (!hasClass(elems[i], 'table-bordered')) addClass(elems[i], 'table-bordered');
			if (!hasClass(elems[i], 'table-sm')) addClass(elems[i], 'table-sm');
		}
		document.querySelector(".entry-content img").parentElement.style.textAlign = "center";
	});
	</script>

	<!--start: adsense-->
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0428291735937735"
     crossorigin="anonymous"></script>
	<!-- prahladyeri.github.io -->
	<ins class="adsbygoogle"
		 style="display:block"
		 data-ad-client="ca-pub-0428291735937735"
		 data-ad-slot="9729062115"
		 data-ad-format="auto"
		 data-full-width-responsive="true"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	<!--end: adsense-->
	
	
	
	<!-- End: Prahlad -->
</section>
</div>
</div>


<footer id ="footer" class="text-center">
Copyright (&copy;) 2014-2023 Prahlad Yeri.<br>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</footer>

<script>
function hasClass(ele,cls) {
  return !!ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}
</script>

</body>
</html>