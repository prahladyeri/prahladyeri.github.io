<!DOCTYPE html>
<html lang="en">
<head>
  	<meta charset="utf-8" />
	<title>Linux DIY: How to identify your MTP file-transfer device (such as smart-phone) in Bash</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" property="og:description" content="In the good old days, USB file-transfer between your laptop and smart-phone used to happen through the much easier "mass storage" mode which works just as if you had inserted an external pen-drive. But these days, most smart-phones and tablets have shifted to the MTP (Media Transfer Protocol). Unlike a …">
	<meta name="author" content="Prahlad Yeri">
	<!-- Google Fonts -->
	<!--link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300&display=swap" rel="stylesheet"-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<link rel="stylesheet" href="/theme/css/app.css">
	<link rel="stylesheet" href="/theme/css/pygment.css">		
	<link rel="shortcut icon" type="image/x-icon" href="/uploads/py.png" />
	<link href="https://prahladyeri.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Full Atom Feed" />
	<link href="https://prahladyeri.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Prahlad Yeri's Blog Full RSS Feed" />
	<link href="https://prahladyeri.github.io/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Categories Atom Feed" />




    <meta name="tags" content="Linux" />
    <meta name="tags" content="Bash" />
    <meta name="tags" content="MTP" />
    <meta name="tags" content="How To" />

	
	
	<!-- twitter card meta data -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@prahladyeri" />
	<meta name="twitter:creator" content="@prahladyeri" />
		<link rel="canonical" content="https://prahladyeri.github.io/blog/2019/10/how-to-identify-mtp-device-bash.html" />
		<meta name="twitter:url" content="https://prahladyeri.github.io/blog/2019/10/how-to-identify-mtp-device-bash.html" />
		<meta name="twitter:title" content="Linux DIY: How to identify your MTP file-transfer device (such as smart-phone) in Bash" />
		<meta name="twitter:description" content="In the good old days, USB file-transfer between your laptop and smart-phone used to happen through the much easier "mass storage" mode which works just as if you had inserted an external pen-drive. But these days, most smart-phones and tablets have shifted to the MTP (Media Transfer Protocol). Unlike a …" />
			<meta name="twitter:image" content="https://prahladyeri.github.io/uploads/cover.jpg" />
			<meta name="image" property="og:image" content="https://prahladyeri.github.io/uploads/cover.jpg">

	<!-- open graph meta data (TODO) -->
	
	<!--start: analytics -->
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-6808883-5"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-6808883-5');
	</script>
	<!--end: analytics -->
	
<!--pinterest claim-->
<meta name="p:domain_verify" content="eb43d46309e2766ef1b627cea2d19326"/>
</head>

<body id="index" class="home">
<!-- section bootstrap-menu -->
<div class='container'>
<div class='row header'>
	<div class='col-md-12 text-center' style='margin: 10px 0 0 0'>
		<h2>Prahlad Yeri</h2>
		<h6 class='text-muted'>Freelance Programmer and Writer</h6>
	</div>
	<div class='col-md-12 text-center' >
		<ul class="nav nav-fill text-center site-links col-md-8 ml-auto mr-auto">
		<li class="nav-item"><a class="nav-link btn btn-primary" href="/">Home</a></li>
		<li class="nav-item"><a class="nav-link btn btn-success" href="/blog">Blog</a></li>
		<li class="nav-item"><a class="nav-link btn btn-danger" href="/portfolio">Portfolio</a></li>
		<li class="nav-item"><a class="nav-link btn btn-secondary" href="https://github.com/prahladyeri/resume">Resume</a></li>
		<li class="nav-item"><a class="nav-link btn btn-warning" href="/hire-me">Hire Me</a></li>
		<li class='nav-item dropdown'>
			<a class="nav-link dropdown-toggle btn btn-dark" id='btnSocial' href="javascript:" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Social</a>
			<div class="dropdown-menu" aria-labelledby="btnSocial">
				<a class="dropdown-item" href="https://twitter.com/prahladyeri">Twitter</a>
				<a class="dropdown-item" href="https://github.com/prahladyeri">Github</a>
				<a class="dropdown-item" href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a>
				<a class="dropdown-item" href="https://prahladyeri.medium.com/">Medium</a>
				<a class="dropdown-item" href="https://www.quora.com/profile/Prahlad-Yeri">Quora</a>
				<a class="dropdown-item" href="https://www.instagram.com/prahladyeri14/">Instagram</a>
				<a class="dropdown-item" href="mailto:prahladyeri@yahoo.com">Email</a>
			</div>
		</li>
		<li class='btn-group'>
			<a class="nav-link dropdown-toggle btn btn-info" role='button' id='btnFeeds' href="javascript:" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Feeds</a>
			<div class="dropdown-menu" aria-labelledby="btnFeeds">
				<a class="dropdown-item" href="/feeds/all.rss.xml">RSS</a>
				<a class="dropdown-item" href="/feeds/all.atom.xml">ATOM</a>
				<!-- <a class="dropdown-item" href="https://feedburner.google.com/fb/a/mailverify?uri=prahladyeri&amp;loc=en_US">Feedburner</a> -->
			</div>
		</li>
		</ul>
	</div>
</div>

<div class='row'>
	<div class='ml-auto col-md-8 mr-auto'>
	</div>
</div>
</div>

		<div id="main" class='mt-2 container content '>
			<div class='row'>
				<div class='offset-md-2 col-md-8'>
<section id="content" class="body">
  <header>
    <h1 class="entry-title">
      <span class="text-secondary" href="https://prahladyeri.github.io/blog/2019/10/how-to-identify-mtp-device-bash.html" rel="bookmark" 
      title="Permalink to Linux DIY: How to identify your MTP file-transfer device (such as smart-phone) in Bash">Linux DIY: How to identify your MTP file-transfer device (such as smart-phone) in Bash</span></h1>
 
  </header>
  <footer class="post-info clearfix">
	<span class='float-sm-none float-md-left'>
    <time class="text-muted published" datetime="2019-10-27T17:50:00+05:30">Sun 27 October 2019</time>
    <div class="text-muted vcard author">
      By           <a class="url fn" href="https://prahladyeri.github.io/">Prahlad Yeri</a>
    </div>
	</span>
	<div class='float-sm-none float-md-right'>
    <div class="text-muted category text-right">
        Filed under <a href="https://prahladyeri.github.io/blog/category/linux">Linux</a>
    </div>
    <div class="text-muted tags">
		Tags
            <a href="https://prahladyeri.github.io/blog/tag/linux">Linux</a>
            <a href="https://prahladyeri.github.io/blog/tag/bash">Bash</a>
            <a href="https://prahladyeri.github.io/blog/tag/mtp">MTP</a>
            <a href="https://prahladyeri.github.io/blog/tag/how-to">How To</a>
    </div>
	</div>
  </footer><!-- /.post-info -->
  <br>
  <div class="entry-content">
    <p>In the good old days, USB file-transfer between your laptop and smart-phone used to happen through the much easier "mass storage" mode which works just as if you had inserted an external pen-drive. But these days, most smart-phones and tablets have shifted to the MTP (Media Transfer Protocol).</p>
<p>Unlike a mass storage device, the MTP device doesn't show up in the usual <code>/media/&lt;user&gt;/&lt;device-label&gt;</code> folder in a linux distro which makes backup automation or other file transfer tasks more difficult as you cannot simply hard-code this path and write bash scripts based on that.</p>
<p>This isn't possible in case of MTP because the label is dynamically determined using two important bits of information called <em>BusID</em> and <em>DeviceID</em>, and the file-system path works out to be something like this:</p>
<p>/run/user/1000/gvfs/mtp:host=%5Busb%3A<strong>001</strong>%2C<strong>010</strong>%5D/Internal shared storage</p>
<p>In this example, <code>001</code> is the BusID whereas <code>010</code> is the DeviceID. You can find these two values by running the <code>lsusb</code> command before and after the MTP device is inserted:</p>
<p><img alt="bash lsusb" src="/uploads/lsusb1.png"></p>
<p>However, these two numbers (BusID and DeviceID) are dynamically determined depending on when and where you inserted the MTP device. Hence, if you are writing an automation script for backup, etc., you need to calculate it using other two static bits of information which are always constant for your device, they are called <em>VendorID</em> and <em>ProductID</em>.</p>
<p>In this example (for my Redmi Y2 phone), they happen to be <code>2717:ff40</code> (displayed right next to the BusID and DeviceID in above screen). Now that you have these two static bits of information which are always going to be in a given format (<code>VendorID:ProductID</code>), you can pass it to a bash function to determine the path dynamically:</p>
<div class="highlight"><pre><span></span><span class="k">function</span> get_mtp_path<span class="o">()</span> <span class="o">{</span>
    <span class="nv">str</span><span class="o">=</span><span class="k">$(</span>lsusb<span class="p">|</span>grep <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="k">)</span>
    <span class="nv">bus</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$str</span> <span class="p">|</span> awk <span class="s1">&#39;{split($0,a,&quot; &quot;); print a[2]}&#39;</span><span class="sb">`</span>
    <span class="nv">dvc</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$str</span> <span class="p">|</span> awk <span class="s1">&#39;{split($0,a,&quot; &quot;); print a[4]}&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/://g&#39;</span> <span class="sb">`</span>
    <span class="nb">echo</span> <span class="s2">&quot;mtp:host=%5Busb%3A</span><span class="nv">$bus</span><span class="s2">%2C</span><span class="nv">$dvc</span><span class="s2">%5D&quot;</span>
<span class="o">}</span>

<span class="nv">redmi_y2</span><span class="o">=</span><span class="s2">&quot;2717:ff40&quot;</span>
<span class="nv">redmi_y2_path</span><span class="o">=</span><span class="sb">`</span>get_mtp_path <span class="s2">&quot;</span><span class="nv">$redmi_y2</span><span class="s2">&quot;</span><span class="sb">`</span>
<span class="nv">folder</span><span class="o">=</span><span class="s2">&quot;/run/user/1000/gvfs/</span><span class="nv">$redmi_y2_path</span><span class="s2">&quot;</span>
</pre></div>


<p>In above script, <code>$redmi_y2</code> variable is hard-coded which is then passed to the <code>get_mtp_path</code> bash function to determine the actual path which is then stored in the <code>$folder</code> variable.</p>
<p>Now that you have <code>$folder</code>, you can do anything with it. For example, you can use rsync to backup your smart-phone pics in the <code>DCIM</code> folder to your laptop:</p>
<div class="highlight"><pre><span></span>rsync -vrt <span class="s2">&quot;</span><span class="nv">$folder</span><span class="s2">/Internal storage/DCIM/&quot;</span> <span class="s2">&quot;~/Pictures/&quot;</span>
</pre></div>


<p>Alternatively, you can run a normal backup of your <code>Documents</code> folder to your smart-phone:</p>
<div class="highlight"><pre><span></span>rsync -vrt  <span class="s2">&quot;~/Documents/&quot;</span> <span class="s2">&quot;</span><span class="nv">$folder</span><span class="s2">/Internal storage/Documents/&quot;</span>
</pre></div>


<p>The possibilities of this are immense!</p>
  </div><!-- /.entry-content -->

	<!-- Start: Prahlad -->
	<script>
	$(document).ready(function(){
		$(".entry-content table").addClass("table table-bordered table-sm");
		$(".entry-content img").parent().css({'text-align': 'center'});
	});
	</script>

	<!--start: adsense-->
	<!--end: adsense-->
	
	
	
	<!-- End: Prahlad -->
</section>
				</div>
				<div class='col-md-2 amz-block-right '> <!--align-self-center-->
					<div style='margin-top: 50px;'>

<!-- AMAZON AFFILIATE ADS -->
<!--
<a href="https://www.amazon.in/Automate-Boring-Stuff-Python-2nd/dp/1593279922/ref=as_li_ss_il?crid=JA705IOUH74O&keywords=automate+the+boring+stuff+with+python&qid=1583912586&sprefix=automate+the+,aps,460&sr=8-1&linkCode=li2&tag=prahladyeri-21&linkId=5f899269cc1aea74977c02963a9a6caf&language=en_IN" target="_blank"><img border="0" src="//ws-in.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=1593279922&Format=_SL160_&ID=AsinImage&MarketPlace=IN&ServiceVersion=20070822&WS=1&tag=prahladyeri-21&language=en_IN" ></a><img src="https://ir-in.amazon-adsystem.com/e/ir?t=prahladyeri-21&language=en_IN&l=li2&o=31&a=1593279922" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<a href="https://www.amazon.in/PYTHON-PROGRAMMING-BEGINNERS-GUIDE-LEARN-ebook/dp/B01GSODGZC/ref=as_li_ss_il?crid=33LIIMVDMW1U3&keywords=python+programming&qid=1583912662&sprefix=python,aps,527&sr=8-4&linkCode=li2&tag=prahladyeri-21&linkId=6b3a8b38eda1d6c51546a1a0c321cfea&language=en_IN" target="_blank"><img border="0" src="//ws-in.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B01GSODGZC&Format=_SL160_&ID=AsinImage&MarketPlace=IN&ServiceVersion=20070822&WS=1&tag=prahladyeri-21&language=en_IN" ></a><img src="https://ir-in.amazon-adsystem.com/e/ir?t=prahladyeri-21&language=en_IN&l=li2&o=31&a=B01GSODGZC" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
-->

					</div>
				</div>
			</div>
		</div>

<div class='container-fluid'>
<div class='row'>
		<footer id ="footer" class="col-md-12 text-center bg-dark text-white pt-1 pb-1 pl-1 pr-1">
		Copyright (&copy;) 2014-2022 Prahlad Yeri. This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
		</footer>
</div>
</div>		

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<!-- <script src="/theme/js/popper.min.js"></script> -->
<!-- <script src="/theme/js/bootstrap.min.js"></script> -->
</body>
</html>