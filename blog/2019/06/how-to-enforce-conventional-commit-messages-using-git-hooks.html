<!DOCTYPE html>
<html lang="en">
<head>
  	<meta charset="utf-8" />
	<title>How to enforce conventional commit messages using git hooks</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" property="og:description" content="Conventional git commit messages are not just nice to have but great to have. In fact, once you get to know them, you'll start feeling that they are essential in any serious programming project. Consider the difference between following two commit messages for instance: git commit -m "added social login …">
	<link rel="canonical" content="https://prahladyeri.github.io/blog/2019/06/how-to-enforce-conventional-commit-messages-using-git-hooks.html" />
	<meta name="author" content="Prahlad Yeri">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<link rel="stylesheet" href="/theme/css/app.css?v=1.3">
	<link rel="stylesheet" href="/theme/css/pygment.css">		
	<link rel="shortcut icon" type="image/x-icon" href="/uploads/py.png" />
	<link href="https://prahladyeri.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Full Atom Feed" />
	<link href="https://prahladyeri.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Prahlad Yeri's Blog Full RSS Feed" />
	<link href="https://prahladyeri.github.io/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri's Blog Categories Atom Feed" />




    <meta name="tags" content="Git" />
    <meta name="tags" content="Open Source" />
    <meta name="tags" content="How To" />

	
	
	
	<!-- twitter card meta data -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@prahladyeri" />
	<meta name="twitter:creator" content="@prahladyeri" />
		<meta name="twitter:url" content="https://prahladyeri.github.io/blog/2019/06/how-to-enforce-conventional-commit-messages-using-git-hooks.html" />
		<meta name="twitter:title" content="How to enforce conventional commit messages using git hooks" />
		<meta name="twitter:description" content="Conventional git commit messages are not just nice to have but great to have. In fact, once you get to know them, you'll start feeling that they are essential in any serious programming project. Consider the difference between following two commit messages for instance: git commit -m "added social login …" />
			<meta name="twitter:image" content="https://prahladyeri.github.io/uploads/cover.jpg" />
			<meta name="image" property="og:image" content="https://prahladyeri.github.io/uploads/cover.jpg">

	
	
<!--pinterest claim-->
<meta name="p:domain_verify" content="eb43d46309e2766ef1b627cea2d19326"/>
</head>

<body>
<div id='header'>
<div class='text-center' >
	<h1 style='color:darkseagreen'>Prahlad Yeri</h1>
	<h4  style='color:grey;'>Freelance Programmer and Writer</h4>
</div>

<div id='navBlock' class='text-center' >
	<a class="nav-link" href="/">Home</a> | 
	<a class="nav-link" href="/blog">Blog</a> | 
	<a class="nav-link" href="/portfolio">Portfolio</a> | 
	<a class="nav-link" href="https://github.com/prahladyeri/resume">Resume</a> | 
	<a class="nav-link" href="/hire-me">Hire Me</a>
	<br>
	Social:
	<a class="nav-link" href="https://twitter.com/prahladyeri">Twitter</a> | 
	<a class="nav-link" href="https://github.com/prahladyeri">Github</a> | 
	<a class="nav-link" href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a> | 
	<a class="nav-link" href="https://prahladyeri.medium.com/">Medium</a> | 
	<a class="nav-link" href="https://www.quora.com/profile/Prahlad-Yeri">Quora</a>
	<br>
	Email: prahladyeri at yahoo dot com | 
	Feeds:
	<a class="nav-link" href="/feeds/all.rss.xml">RSS</a> | 
	<a class="nav-link" href="/feeds/all.atom.xml">ATOM</a>
</div>
</div>
<div id="main" class='row content '>
<div class='col w50 m-auto'>
<section id="content" class="body">
  <header>
	<h1 style='color: darkolivegreen;' class='mt-4 mb-4'>How to enforce conventional commit messages using git hooks</h1>
 
  </header>
  <footer class="post-info clearfix">
	<span class='float-left'>
    <time class="text-muted published" datetime="2019-06-14T11:58:00+05:30">Fri 14 June 2019</time>
    <div class="text-muted vcard author">
      By           <a class="url fn" href="https://prahladyeri.github.io/">Prahlad Yeri</a>
    </div>
	</span>
	<div class='float-right'>
    <div class="text-muted category text-right">
        Filed under <a href="https://prahladyeri.github.io/blog/category/linux">Linux</a>
    </div>
    <div class="text-muted tags">
		Tags
            <a href="https://prahladyeri.github.io/blog/tag/git">Git</a>
            <a href="https://prahladyeri.github.io/blog/tag/open-source">Open Source</a>
            <a href="https://prahladyeri.github.io/blog/tag/how-to">How To</a>
    </div>
	</div>
  </footer><!-- /.post-info -->
  
  <div class="entry-content">
    <p><a href="https://www.conventionalcommits.org/en/v1.0.0-beta.4/">Conventional git commit messages</a> are not just nice to have but great to have. In fact, once you get to know them, you'll start feeling that they are essential in any serious programming project. Consider the difference between following two commit messages for instance:</p>
<div class="highlight"><pre><span></span>git commit -m &quot;added social login feature for authentication using twitter&quot;
git commit -m &quot;feat(authentication): added social login using twitter&quot;
</pre></div>


<p>The second one is not only more readable but it also follows standards which makes it easier to integrate with build tools such as Travis CI and Appveyor. Not just that, you can easily automate <code>CHANGELOG</code> generation when your <code>git log</code> looks like this:</p>
<div class="highlight"><pre><span></span>&gt; git log --oneline
61c8ca9 (HEAD -&gt; master) fix: navbar not responsive on mobile
479c48b test: prepared test cases for user authentication
a992020 chore: moved to semantic versioning
b818120 fix: button click even handler firing twice
c6e9a97 fix: login page css
dfdc715 feat(authentication): added social login using twitter
</pre></div>


<p>All in all, I like conventional commit messages so much that I don't want to keep it optional but make it the default way of life. How do I do it? The answer is simple: <em>git hooks</em>.</p>
<p>You don't need to be a git ninja or expert to work with hooks. Suffice it to know that inside your special git repository folder (named <code>.git</code>), there are some other special folders:</p>
<div class="highlight"><pre><span></span>logs
hooks
objects
refs
</pre></div>


<p>The one we are interested in is <code>hooks</code>. To get the hang of it, create a test project on your machine and initialize an empty git repository by running:</p>
<div class="highlight"><pre><span></span>git init .
</pre></div>


<p>Now visit the <code>.git</code> folder just generated and navigate to the hooks folder. There will be a bunch of scripts with <code>.sample</code> extension (which means they are all disabled). The one we are interested in is <code>commit-msg</code>. This is the hook that fires just before your commit is made and thus allows you to reject the commit by throwing an error if the message isn't in proper format.</p>
<p>Create a new script in this directory named <code>commit-msg</code> and add the below code (you'll need python installed) to it using your favorite editor (mine is notepad++!):</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># example:</span>
    <span class="c1"># feat(apikey): added the ability to add api key to configuration</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(build|ci|docs|feat|fix|perf|refactor|style|test|chore|revert)(\([\w\-]+\))?:\s.*&#39;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">ss</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;conventional commit validation failed&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>Save the script and make it executable (by running <code>chmod u+x commit-msg</code> on linux, not required on windows). Now head back to your source code folder where you initialized the git repo and create a source file just for testing. Then, <code>git add</code> and try to commit just for testing using a non-conventional message. If all goes well, it should fail like this!</p>
<div class="highlight"><pre><span></span>&gt; git commit -m &quot;added a new feature for xyz&quot;
Traceback (most recent call last):
  File &quot;C:/Users/prahlad/Documents/scripts/check_commit.py&quot;, line 22, in &lt;module&gt;
    main()
  File &quot;C:/Users/prahlad/Documents/scripts/check_commit.py&quot;, line 19, in main
    if m == None: raise Exception(&quot;conventional commit validation failed&quot;)
Exception: conventional commit validation failed    
Now test with a valid commit message and it should work!
</pre></div>


<p>Once you practice this a few times and get a hang over it, you'll then want to make this behavior default for whatever projects you start using <code>git init</code> in future, isn't it? Sure, you can do that by creating a global git commit hook template but that will be a post for another day. First things first!</p>
<p><strong>Edit</strong></p>
<p>For those really interested in enforcing and automating this thing, I've just published a python package called <a href="https://github.com/prahladyeri/enforce-git-message">enforce-git-message</a>. All you need to do is install that python package and it'll automatically copy the above script to your <code>~/.git-templates</code> directory and also set the value for <code>git config init.templatedir</code>.</p>
<div class="highlight"><pre><span></span>pip install enforce-git-message
</pre></div>


<p>References:</p>
<ul>
<li><a href="https://www.conventionalcommits.org/en/v1.0.0-beta.4/">https://www.conventionalcommits.org/en/v1.0.0-beta.4/</a></li>
<li><a href="https://stackoverflow.com/q/3523534/849365">https://stackoverflow.com/q/3523534/849365</a></li>
<li><a href="https://stackoverflow.com/q/37699261/849365">https://stackoverflow.com/q/37699261/849365</a></li>
<li><a href="https://coderwall.com/p/jp7d5q/create-a-global-git-commit-hook">https://coderwall.com/p/jp7d5q/create-a-global-git-commit-hook</a></li>
</ul>
  </div><!-- /.entry-content -->

	<!-- Start: Prahlad -->
	<script>
	$(document).ready(function(){
		$(".entry-content table").addClass("table table-bordered table-sm");
		$(".entry-content img").parent().css({'text-align': 'center'});
	});
	</script>

	<!--start: adsense-->
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0428291735937735"
     crossorigin="anonymous"></script>
	<!-- prahladyeri.github.io -->
	<ins class="adsbygoogle"
		 style="display:block"
		 data-ad-client="ca-pub-0428291735937735"
		 data-ad-slot="9729062115"
		 data-ad-format="auto"
		 data-full-width-responsive="true"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	<!--end: adsense-->
	
	
	
	<!-- End: Prahlad -->
</section>
</div>
</div>


<footer id ="footer" class="text-center">
Copyright (&copy;) 2014-2022 Prahlad Yeri.<br>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</footer>

</body>
</html>